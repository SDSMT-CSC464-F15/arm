
% !TEX root = DesignDocument.tex

\chapter{Design  and Implementation}

The design of the cluster is going change as we test different configurations to determine which is capable of producing the most gigaflops, and as we test different connection methods as we design our custom data transfer protocol. This section will outline the different designs we have created, how they were implemented, and our plans for implementing future designs going forward.

%%
\begin{comment}
This section is used to describe the design details for each of the major components in the system.    Note that this chapter is critical for all tracks.  Research tracks would do experimental design here where other tracks would include the engineering design aspects.    This section is not brief and requires the necessary detail that can be used by the reader to truly understand the architecture and implementation details without having to dig into the code.    Sample algorithm:  Algorithm~\ref{alg1}.  This algorithm environment is automatically placed - meaning it floats.   You don't have to worry about placement or numbering.  

\begin{algorithm} [tbh]                     % enter the algorithm environment
\caption{Calculate $y = x^n$}          % give the algorithm a caption
\label{alg1}                           % and a label for \ref{} commands later in the document
\begin{algorithmic}                    % enter the algorithmic environment
    \REQUIRE $n \geq 0 \vee x \neq 0$
    \ENSURE $y = x^n$
    \STATE $y \Leftarrow 1$
    \IF{$n < 0$}
        \STATE $X \Leftarrow 1 / x$
        \STATE $N \Leftarrow -n$
    \ELSE
        \STATE $X \Leftarrow x$
        \STATE $N \Leftarrow n$
    \ENDIF
    \WHILE{$N \neq 0$}
        \IF{$N$ is even}
            \STATE $X \Leftarrow X \times X$
            \STATE $N \Leftarrow N / 2$
        \ELSE[$N$ is odd]
            \STATE $y \Leftarrow y \times X$
            \STATE $N \Leftarrow N - 1$
        \ENDIF
    \ENDWHILE
\end{algorithmic}
\end{algorithm}
Citations look like~\cite{Choset:2005:PRM, arkin2009governing, lavalle2006}  and~\cite{wiki:asimo,lumelsky:1987, nolfi2000evolutionary}.  These are done automatically.  Just fill in the database {\tt designrefs.bib} using the same field structure as the other entries.  Then pdflatex the document, bibtex the document and pdflatex twice again.  The first pdflatex creates requests for bibliography entries.
The bibtex extracts and formats the requested entries.  The next pdflatex puts them in order and assigns labels.  The final pdflatex replaces references in the text with the assigned labels.
The bibliography is automatically constructed.  
 \end{comment}

 \section{Architecture and System Design}
 %%This is where you will place the overall system design or the architecture.   This section should be image rich.  There is the old phrase {\it a picture is worth a thousand words}, in this class it could be worth a hundred points (well if you sum up over the entire team).   One needs to enter the design and why a particular design has been done.   
 %% Andrew labeled this secion as Cluster Configure in our old template
 The first design we implemented was a star topology, with each device of the eight devices connected over Ethernet to a central switch. Each device was configured to be on the same network and capable of communicating over the switch via IP addresses. We configured the /home directory of our head node, Snow White, to be an NFS export that the seven other nodes would mount in their /home directory. 
 
 
 \subsection{Design Selection}
 %%Failed designs, design ideas, rejected designs here.
 
 \subsection{Data Structures and Algorithms}
 %%Describe the special data structures and any special algorithms.
 
 \subsection{Data Flow}
 
 \subsection{Communications}
 
 \subsection{Classes}
 
 \subsection{UML}
 
 \subsection{GUI}
 
 \subsection{MVVM, etc}

\section{Major Component \#1 }

\subsection{Technologies  Used}
%%This section provides a list of technologies used for this component.  The details for the technologies have already been provided in the Overview section. 

\subsection{Component  Overview}
%%This section can take the form of a list of features. 

\subsection{Phase Overview}
%%This is an extension of the Phase Overview above, but specific to this component. It is meant to be basically a brief list with space for marking the phase status. 

\subsection{ Architecture  Diagram}
%%It is important to build and maintain an architecture diagram.  However, it may be that a component is best described visually with a data flow diagram. 


\subsection{Data Flow Diagram}
%%It is important to build and maintain a data flow diagram.  However, it may be that a component is best described visually with an architecture diagram. 


\subsection{Design Details}
%%This is where the details are presented and may contain subsections.   Here is an example code listing:
First, we made the devices able to communicate on the same network. We assigned each device a static IP address by editing the /etc/networking/interfaces file to incluce the IP address chosen for the device. All addresses were on the 192.168.1.1 network, and the last number was 11 through 18 for the eight devices.

Next, we set each device to be able to use our naming convention in place of an IP address for any purpose, such as by using "ssh sleepy" instead of "ssh 192.168.1.13". To do this, we changed the /etc/hostname file to replace "odroid" with the name we wanted, and added entries to /etc/hosts to include the IP address of the other seven decives. 

We then set the /home directory of Snow White to be an NFS share that could be mounted on the dwarfs. After nfs-kernel-server was installed on Snow White, we edited it's /etc/exports file to include /home as an export. The dwarfs then installed nfs-common and used the command "mount SnowWhite:/home /home" to mount the home directory of Snow White over their own.

To make this mount process automatic on boot, we edited the /etc/fstab file on each dwarf to make them mount Snow White's home directory as part of the boot process. This proved unsuccesful, however, on all devices except for on. As a work around, we wrote a Python tool that can be run from Snow White to mount it's home directory on the dwarfs.

\begin{lstlisting}
#!/bin/usr/python

import os

def Main():

        hosts = [ 'snow_white', 'dopey', 'sleepy', 'grumpy', 'doc', 'happy',
 				  'bashful', 'sneezy' ]

        for host in hosts:
                if host != 'snow_white':
                        cmd = "ssh odroid@" + host + " 'sudo mount -t nfs snow_white:/
							   home /home'"
                        os.system( cmd )

if __name__ == '__main__':
        Main()
\end{lstlisting}
%%This code listing is not floating or automatically numbered.  If you want auto-numbering, but it in the algorithm environment (not algorithmic however) shown above.

\section{Major Component \#2 }

\subsection{Technologies  Used}
%%This section provides a list of technologies used for this component.  The details for the technologies have already been provided in the Overview section. 

\subsection{Component  Overview}
%%This section can take the form of a list of features. 

\subsection{Phase Overview}
%%This is an extension of the Phase Overview above, but specific to this component. It is meant to be basically a brief list with space for marking the phase status. 

\subsection{ Architecture  Diagram}
%%It is important to build and maintain an architecture diagram.  However, it may be that a component is best described visually with a data flow diagram. 


\subsection{Data Flow Diagram}
%%It is important to build and maintain a data flow diagram.  However, it may be that a component is best described visually with an architecture diagram. 


\subsection{Design Details}
%%This is where the details are presented and may contain subsections. 


\section{Major Component \#3 }

\subsection{Technologies  Used}
%%This section provides a list of technologies used for this component.  The details for the technologies have already been provided in the Overview section. 
We used several Linux system configuration tools to implement the cluster. We used the files
\begin{itemize}
	\item etc/network/interfaces
	\item etc/exports
	\item etc/hostname
	\item etc/hosts
	\item etc/fstab
\end{itemize}
for several different configuration setting. We also used a few packages availible from the defual debian repositories.
\begin{itemize}
	\item nfs-kernel-server
	\item nfs-common
	\item mpi-dev
\end{itemize}

Finally, we used SSH tools that are installed by default on Ubuntu 15.


\subsection{Component  Overview}
%%This section can take the form of a list of features. 
The features implented by this configuration were:

\begin{itemize}
	\item All devices recognizing the others over Ethernet.
	\item SSH without requiring a password.
	\item Mount home directory of Snow White on the dwarfs.
	\item Running MPI code on all devices.
\end{itemize}


\subsection{Phase Overview}
%%This is an extension of the Phase Overview above, but specific to this component. It is meant to be basically a brief list with space for marking the phase status. 

\subsection{ Architecture  Diagram}
%%It is important to build and maintain an architecture diagram.  However, it may be that a component is best described visually with a data flow diagram. 


\subsection{Data Flow Diagram}
%%It is important to build and maintain a data flow diagram.  However, it may be that a component is best described visually with an architecture diagram. 


\subsection{Design Details}
%%This is where the details are presented and may contain subsections. 

